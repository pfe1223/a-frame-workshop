<html>

<head>
  <script src="https://aframe.io/releases/0.7.1/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/p5.min.js"></script>
  <script type="text/javascript">
    AFRAME.registerComponent('my-animation', {
      schema: {
        speedX: {
          type: 'float',
          default: 0
        },
        speeZ: {
          type: 'float',
          default: 0
        },
        totalSizeX: {
          type: 'float'
        },
        phase: {
          type: 'float',
          default: 0
        },
        height: {
          type: 'float'
        }
      },
      tick: function(time, timeDelta) {
        let position = this.el.object3D.position;
        // position.setY(position.Y + map(noise, 0, 1, -1, 1));
        position.setY(this.data.height * (Math.sin((time * 0.001) + this.data.phase)));
        position.setX(position.x + (this.data.speedX * timeDelta));

        if (position.x >= (this.data.totalSizeX)) {
          position.setX(0);
        }
      }
    });
  </script>
</head>

<body>
  <a-scene antialias="true" fog="type:linear; color:#000; near:30; far:45">
    <a-sky color="#000"></a-sky>
    <a-entity camera position="0 10 4" look-controls></a-entity>
  </a-scene>

  <script type="text/javascript">
    let scene = document.querySelector('a-scene');
    let elementRadius = 0.5;
    let objectCount = 25;
    let elementSpacing = 1;
    let size = (elementRadius * 2) + elementSpacing;
    let totalSize = objectCount * size;
    let speedX = 0.03;

    let containerElement = document.createElement('a-entity');
    containerElement.setAttribute('position', `${-0.5* totalSize} 0 ${-0.5* totalSize}`)
    scene.appendChild(containerElement);

    function create3DObject(x, z, phase) {
      let element = document.createElement('a-entity');
      element.setAttribute('geometry', `primitive: torusKnot; radius: ${elementRadius};`);
      element.setAttribute('material', `color:#${getRandomColor()}; metalness: 0; roughness: 0`);
      element.setAttribute('position', `${x} 0 ${z}`);
      element.setAttribute('my-animation', `height: 10; phase: ${phase}; speedX:${speedX}; totalSizeX:${totalSize}`);
      containerElement.appendChild(element);
    }

    function addObjects() {
      for (let i = 0; i < objectCount; i++) {
        for (let j = 0; j < objectCount; j++) {
          let phase = 2 * Math.PI * i / objectCount + 2 * Math.PI * j / objectCount;
          create3DObject(i * size, j * size, phase);
        }
      }
    }

    addObjects();

    // get random hex color
    function getRandomColor() {
      let letters = '0123456789abcdef';
      let randomColor = '';
      for (let i = 0; i < 6; i++) {
        randomColor += letters[Math.floor(Math.random() * 16)];
      }
      return randomColor;
    }
  </script>

  <body>

</html>